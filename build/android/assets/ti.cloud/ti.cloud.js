defineCloud(exports);function defineCloud(k){function f(c,b,d){if(void 0===b)throw"Argument "+c+" was not provided!";if(typeof b!=d)throw"Argument "+c+" was an unexpected type! Expected: "+d+", Received: "+typeof b}function c(d,b,a,f){k.debug&&Ti.API.info("ACS Request: { url: \""+d+"\", verb: \""+b+"\", data: "+JSON.stringify(a)+" })"),r.send(d,b,a,function(b){if(f){var a=b.response||{};b.meta&&"ok"==b.meta.status?(a.success=!0,a.error=!1,a.meta=b.meta,k.debug&&Ti.API.info(JSON.stringify(a))):(a.success=!1,a.error=!0,a.code=b.meta?b.meta.code:b.statusCode,a.message=b.meta?b.meta.message:b.message||b.statusText,k.debug&&Ti.API.error(a.code+": "+a.message)),f(a)}})}function g(d,b){f("data",d,"object"),f("callback",b,"function"),j(this),this.url||(this.url=this.restNamespace+"/"+this.restMethod+".json"),c(this.url,this.verb,d,b)}function a(){g.call(this,2==arguments.length?arguments[0]:{},2==arguments.length?arguments[1]:arguments[0])}function j(a){a.restNamespace||(a.restNamespace=a.property.toLowerCase()),a.restMethod||(a.restMethod=a.method.toLowerCase())}function e(){var c=arguments;g.call(this,2==c.length?c[0]:{},function(b){r.reset(),(2==c.length?c[1]:c[0])(b)})}function l(p,b){p[b>>5]|=128<<24-b%32,p[(b+64>>9<<4)+15]=b;for(var a=Array(80),e=1732584193,c=-271733879,r=-1732584194,f=271733878,d=-1009589776,k=0;k<p.length;k+=16){for(var j=e,h=c,i=r,s=f,t=d,l=0;80>l;l++){a[l]=16>l?p[k+l]:(a[l-3]^a[l-8]^a[l-14]^a[l-16])<<1|(a[l-3]^a[l-8]^a[l-14]^a[l-16])>>>31;var m,o=e<<5|e>>>27;m=20>l?c&r|~c&f:40>l?c^r^f:60>l?c&r|c&f|r&f:c^r^f,o=q(q(o,m),q(q(d,a[l]),20>l?1518500249:40>l?1859775393:60>l?-1894007588:-899497514)),d=f,f=r,r=c<<30|c>>>2,c=e,e=o}e=q(e,j),c=q(c,h),r=q(r,i),f=q(f,s),d=q(d,t)}return[e,c,r,f,d]}function q(c,b){var a=(65535&c)+(65535&b);return(c>>16)+(b>>16)+(a>>16)<<16|65535&a}function m(d){for(var b=[],a=0;a<d.length*v;a+=v)b[a>>5]|=(d.charCodeAt(a/v)&(1<<v)-1)<<32-v-a%32;return b}function o(b,d,a,e,c){var g=!1;return this.appKey=b,this.oauthKey=d,this.oauthSecret=a,this.apiBaseURL=e?e:p.sdk.url.baseURL,this.authBaseURL=c?c:p.sdk.url.authBaseURL,this.useThreeLegged=function(b){g=b,this.oauthKey||(this.oauthKey=this.appKey)},this.isThreeLegged=function(){return g},this}var p,n=Math.floor,b={PROPERTY_TYPE_ONLY_LATEST:0,PROPERTY_TYPE_SLASH_COMBINE:1,PROPERTY_TYPE_IGNORE:2};b.build=function g(a,e){var c,f=e.children||[];for(c in f)if(f.hasOwnProperty(c)){var i=f[c],d=i.propertyTypes||e.propertyTypes||{};for(var k in d.children=b.PROPERTY_TYPE_IGNORE,e)if(e.hasOwnProperty(k))switch(d[k]||b.PROPERTY_TYPE_ONLY_LATEST){case b.PROPERTY_TYPE_ONLY_LATEST:i[k]=void 0===i[k]?e[k]:i[k];break;case b.PROPERTY_TYPE_SLASH_COMBINE:var j=[];e[k]&&j.push(e[k]),i[k]&&j.push(i[k]),i[k]=j.join("/");}i.method&&!i.children?a[i.method]=function(b){return function(){return b.executor.apply(b,arguments)}}(i):i.property&&g(a[i.property]={},i)}},b.build(k,{verb:"GET",executor:g,children:[{method:"sendRequest",executor:function(b,a){f("params",b,"object"),f("url",b.url,"string"),f("method",b.method,"string"),f("callback",a,"function"),c(b.url,b.method,b.data?b.data:{},a)}},{method:"createX509CertificatePinningSecurityManager",executor:function(b){var a=!0;try{var d=require("appcelerator.https")}catch(b){Ti.API.error(b+" SecurityManager not set."),a=!1}a&&(b=d.createX509CertificatePinningSecurityManager(b),p.js.sdk.utils.setSecurityManager(b))}},{method:"hasStoredSession",executor:function(){return Ti.API.warn("Cloud.hasStoredSession has been deprecated. Use Cloud.sessionId property"),r.hasStoredSession()}},{method:"retrieveStoredSession",executor:function(){return Ti.API.warn("Cloud.retrieveStoredSession has been deprecated. Use Cloud.sessionId property"),r.retrieveStoredSession()}},{property:"ACLs",children:[{method:"create",verb:"POST"},{method:"update",verb:"PUT"},{method:"show"},{method:"remove",restMethod:"delete",verb:"DELETE"},{method:"addUser",restMethod:"add",verb:"POST"},{method:"removeUser",restMethod:"remove",verb:"DELETE"},{method:"checkUser",restMethod:"check"}]},{property:"Chats",children:[{method:"create",verb:"POST"},{method:"query"},{method:"remove",restMethod:"delete",verb:"DELETE"},{method:"queryChatGroups",restMethod:"query_chat_groups",executor:a},{method:"getChatGroups",restMethod:"get_chat_groups",executor:a}]},{property:"Checkins",children:[{method:"create",verb:"POST"},{method:"query",executor:a},{method:"show"},{method:"remove",restMethod:"delete",verb:"DELETE"}]},{property:"Clients",children:[{method:"geolocate",executor:a}]},{property:"Objects",executor:function(b,d){var e;b&&"object"==typeof b&&(f("data.classname",b.classname,"string"),j(this),this.url=this.restNamespace+"/"+b.classname+"/"+this.restMethod+".json",e=b.classname,delete b.classname),g.call(this,b,d),b.classname=e},children:[{method:"create",verb:"POST"},{method:"show"},{method:"update",verb:"PUT"},{method:"remove",restMethod:"delete",verb:"DELETE"},{method:"query"}]},{property:"Emails",restNamespace:"custom_mailer",children:[{method:"send",verb:"POST",restMethod:"email_from_template"}]},{property:"Events",children:[{method:"create",verb:"POST"},{method:"show"},{method:"showOccurrences",restMethod:"show/occurrences"},{method:"query",executor:a},{method:"queryOccurrences",restMethod:"query/occurrences",executor:a},{method:"search",executor:a},{method:"searchOccurrences",restMethod:"search/occurrences",executor:a},{method:"update",verb:"PUT"},{method:"remove",restMethod:"delete",verb:"DELETE"}]},{property:"Files",children:[{method:"create",verb:"POST"},{method:"query",executor:a},{method:"show"},{method:"update",verb:"PUT"},{method:"remove",restMethod:"delete",verb:"DELETE"}]},{property:"Friends",children:[{method:"add",verb:"POST"},{method:"requests",executor:a},{method:"approve",verb:"PUT"},{method:"remove",verb:"DELETE"},{method:"search"}]},{property:"GeoFences",restNamespace:"geo_fences",children:[{method:"create",verb:"POST"},{method:"update",verb:"PUT"},{method:"remove",restMethod:"delete",verb:"DELETE"},{method:"query"}]},{property:"KeyValues",children:[{method:"set",verb:"PUT"},{method:"get"},{method:"append",verb:"PUT"},{method:"increment",restMethod:"incrby",verb:"PUT"},{method:"remove",restMethod:"delete",verb:"DELETE"}]},{property:"Likes",children:[{method:"create",verb:"POST"},{method:"remove",restMethod:"delete",verb:"DELETE"}]},{property:"Messages",children:[{method:"create",verb:"POST"},{method:"reply",verb:"POST"},{method:"show"},{method:"showInbox",restMethod:"show/inbox",executor:a},{method:"showSent",restMethod:"show/sent",executor:a},{method:"showThreads",restMethod:"show/threads",executor:a},{method:"showThread",restMethod:"show/thread"},{method:"remove",restMethod:"delete",verb:"DELETE"},{method:"removeThread",restMethod:"delete/thread",verb:"DELETE"}]},{property:"Photos",children:[{method:"create",verb:"POST"},{method:"show"},{method:"search"},{method:"query",executor:a},{method:"update",verb:"PUT"},{method:"remove",restMethod:"delete",verb:"DELETE"}]},{property:"PhotoCollections",restNamespace:"collections",children:[{method:"create",verb:"POST"},{method:"show"},{method:"update",verb:"PUT"},{method:"search"},{method:"showSubcollections",restMethod:"show/subcollections"},{method:"showPhotos",restMethod:"show/photos"},{method:"remove",restMethod:"delete",verb:"DELETE"}]},{property:"Places",children:[{method:"create",verb:"POST"},{method:"search",executor:a},{method:"show"},{method:"update",verb:"PUT"},{method:"remove",restMethod:"delete",verb:"DELETE"},{method:"query",executor:a}]},{property:"Posts",children:[{method:"create",verb:"POST"},{method:"show"},{method:"query",executor:a},{method:"update",verb:"PUT"},{method:"remove",restMethod:"delete",verb:"DELETE"}]},{property:"PushNotifications",restNamespace:"push_notification",verb:"POST",children:[{method:"subscribe"},{method:"unsubscribe",verb:"DELETE"},{method:"notify"},{method:"query",verb:"GET"},{method:"subscribeToken",restMethod:"subscribe_token"},{method:"unsubscribeToken",restMethod:"unsubscribe_token",verb:"DELETE"},{method:"updateSubscription",restMethod:"subscription/update",verb:"PUT"},{method:"notifyTokens",restMethod:"notify_tokens"},{method:"resetBadge",restMethod:"reset_badge",verb:"PUT"},{method:"setBadge",restMethod:"set_badge",verb:"PUT",executor:a},{method:"queryChannels",restMethod:"channels/query",verb:"GET",executor:a},{method:"showChannels",restMethod:"channels/show",verb:"GET"}]},{property:"PushSchedules",restNamespace:"push_schedules",children:[{method:"create",restMethod:"create",verb:"POST"},{method:"query",restMethod:"query",executor:a},{method:"remove",restMethod:"delete",verb:"DELETE"}]},{property:"Reviews",children:[{method:"create",verb:"POST"},{method:"show"},{method:"query"},{method:"update",verb:"PUT"},{method:"remove",restMethod:"delete",verb:"DELETE"}]},{property:"SocialIntegrations",restNamespace:"users",children:[{method:"externalAccountLogin",restMethod:"external_account_login",verb:"POST"},{method:"externalAccountLink",restMethod:"external_account_link",verb:"POST"},{method:"externalAccountUnlink",restMethod:"external_account_unlink",verb:"DELETE"},{method:"searchFacebookFriends",restNamespace:"social",restMethod:"facebook/search_friends",executor:a}]},{property:"Statuses",children:[{method:"create",verb:"POST"},{method:"update",verb:"PUT"},{method:"show"},{method:"search"},{method:"query",executor:a},{method:"remove",restMethod:"delete",verb:"DELETE"}]},{property:"Users",children:[{method:"create",verb:"POST"},{method:"login",verb:"POST"},{method:"show"},{method:"showMe",restMethod:"show/me",executor:function(b){g.call(this,{},b)}},{method:"search",executor:a},{method:"query",executor:a},{method:"update",verb:"PUT"},{method:"logout",executor:e},{method:"remove",restMethod:"delete",verb:"DELETE",executor:e},{method:"requestResetPassword",restMethod:"request_reset_password"},{method:"resendConfirmation",restMethod:"resend_confirmation"}]}]});var t;null==t&&(t={}),t.setProperties=function(b,a){if(null!=b&&null!=a)for(var d in a)b[d]=a[d];return b},t.setProperties(t,{percentEncode:function(b){if(null==b)return"";if(b instanceof Array){for(var a="";0<b.length;++b)""!=a&&(a+="&"),a+=t.percentEncode(b[0]);return a}return b=encodeURIComponent(b),b=b.replace(/\!/g,"%21"),b=b.replace(/\*/g,"%2A"),b=b.replace(/\'/g,"%27"),b=b.replace(/\(/g,"%28"),b=b.replace(/\)/g,"%29")},decodePercent:function(b){return null!=b&&(b=b.replace(/\+/g," ")),decodeURIComponent(b)},getParameterList:function(b){if(null==b)return[];if("object"!=typeof b)return t.decodeForm(b+"");if(b instanceof Array)return b;var d,c=[];for(d in b)c.push([d,b[d]]);return c},getParameterMap:function(d){if(null==d)return{};if("object"!=typeof d)return t.getParameterMap(t.decodeForm(d+""));if(d instanceof Array){for(var f,b={},e=0;e<d.length;++e)f=d[e][0],void 0===b[f]&&(b[f]=d[e][1]);return b}return d},getParameter:function(b,a){if(b instanceof Array){for(var d=0;d<b.length;++d)if(b[d][0]==a)return b[d][1];}else return t.getParameterMap(b)[a];return null},formEncode:function(d){for(var a,b="",d=t.getParameterList(d),e=0;e<d.length;++e)a=d[e][1],null==a&&(a=""),""!=b&&(b+="&"),b+=t.percentEncode(d[e][0])+"="+t.percentEncode(a);return b},decodeForm:function(d){for(var a,b=[],d=d.split("&"),e=0;e<d.length;++e)if(a=d[e],""!=a){var c,g=a.indexOf("=");0>g?(c=t.decodePercent(a),a=null):(c=t.decodePercent(a.substring(0,g)),a=t.decodePercent(a.substring(g+1))),b.push([c,a])}return b},setParameter:function(d,a,e){var c=d.parameters;if(c instanceof Array){for(d=0;d<c.length;++d)c[d][0]==a&&(void 0===e?c.splice(d,1):(c[d][1]=e,e=void 0));void 0!==e&&c.push([a,e])}else c=t.getParameterMap(c),c[a]=e,d.parameters=c},setParameters:function(c,a){for(var d=t.getParameterList(a),b=0;b<d.length;++b)t.setParameter(c,d[b][0],d[b][1])},completeRequest:function(c,a){null==c.method&&(c.method="GET");var d=t.getParameterMap(c.parameters);null==d.oauth_consumer_key&&t.setParameter(c,"oauth_consumer_key",a.consumerKey||""),null==d.oauth_token&&null!=a.token&&t.setParameter(c,"oauth_token",a.token),null==d.oauth_version&&t.setParameter(c,"oauth_version","1.0"),null==d.oauth_timestamp&&t.setParameter(c,"oauth_timestamp",t.timestamp()),null==d.oauth_nonce&&t.setParameter(c,"oauth_nonce",t.nonce(6)),t.SignatureMethod.sign(c,a)},setTimestampAndNonce:function(b){t.setParameter(b,"oauth_timestamp",t.timestamp()),t.setParameter(b,"oauth_nonce",t.nonce(6))},addToURL:function(c,a){if(newURL=c,null!=a){var d=t.formEncode(a);0<d.length&&(newURL=0>c.indexOf("?")?newURL+"?":newURL+"&",newURL+=d)}return newURL},getAuthorizationHeader:function(c,a){for(var d="OAuth realm=\""+t.percentEncode(c)+"\"",b=t.getParameterList(a),e=0;e<b.length;++e){var f=b[e],g=f[0];0==g.indexOf("oauth_")&&(d+=","+t.percentEncode(g)+"=\""+t.percentEncode(f[1])+"\"")}return d},correctTimestamp:function(b){t.timeCorrectionMsec=1E3*b-new Date().getTime()},timeCorrectionMsec:0,timestamp:function(){var b=new Date().getTime()+t.timeCorrectionMsec;return n(b/1E3)},nonce:function(c){for(var a=t.nonce.CHARS,d="",b=0;b<c;++b)var e=n(Math.random()*a.length),d=d+a.substring(e,e+1);return d}}),t.nonce.CHARS="0123456789ABCDEFGHIJKLMNOPQRSTUVWXTZabcdefghiklmnopqrstuvwxyz",t.declareClass=function(e,a,b){var c=e[a];if(e[a]=b,null!=b&&null!=c)for(var d in c)"prototype"!=d&&(b[d]=c[d]);return b},t.declareClass(t,"SignatureMethod",function(){}),t.setProperties(t.SignatureMethod.prototype,{sign:function(c){var a=this.getSignature(t.SignatureMethod.getBaseString(c));return t.setParameter(c,"oauth_signature",a),a},initialize:function(d,a){var b;b=null!=a.accessorSecret&&9<d.length&&"-Accessor"==d.substring(d.length-9)?a.accessorSecret:a.consumerSecret,this.key=t.percentEncode(b)+"&"+t.percentEncode(a.tokenSecret)}}),t.setProperties(t.SignatureMethod,{sign:function(d,a){var b=t.getParameterMap(d.parameters).oauth_signature_method;(null==b||""==b)&&(b="HMAC-SHA1",t.setParameter(d,"oauth_signature_method",b)),t.SignatureMethod.newMethod(b,a).sign(d)},newMethod:function(d,a){var b=t.SignatureMethod.REGISTERED[d];if(null!=b){var c=new b;return c.initialize(d,a),c}var b=Error("signature_method_rejected"),e="";for(c in t.SignatureMethod.REGISTERED)""!=e&&(e+="&"),e+=t.percentEncode(c);throw b.oauth_acceptable_signature_methods=e,b},REGISTERED:{},registerMethodClass:function(d,a){for(var b=0;b<d.length;++b)t.SignatureMethod.REGISTERED[d[b]]=a},makeSubclass:function(d){var a=t.SignatureMethod,b=function(){a.call(this)};return b.prototype=new a,b.prototype.getSignature=d,b.prototype.constructor=b},getBaseString:function(d){var a=d.action,b=a.indexOf("?");if(0>b)b=d.parameters;else for(var b=t.decodeForm(a.substring(b+1)),c=t.getParameterList(d.parameters),e=0;e<c.length;++e)b.push(c[e]);return t.percentEncode(d.method.toUpperCase())+"&"+t.percentEncode(t.SignatureMethod.normalizeUrl(a))+"&"+t.percentEncode(t.SignatureMethod.normalizeParameters(b))},normalizeUrl:function(d){var a=t.SignatureMethod.parseUri(d),d=a.protocol.toLowerCase(),b=a.authority.toLowerCase();if("http"==d&&80==a.port||"https"==d&&443==a.port){var c=b.lastIndexOf(":");0<=c&&(b=b.substring(0,c))}return(a=a.path)||(a="/"),d+"://"+b+a},parseUri:function(e){for(var a=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"],e=/^(?:([^:\/?#]+):)?(?:\/\/((?:(([^:@\/]*):?([^:@\/]*))?@)?([^:\/?#]*)(?::(\d*))?))?((((?:[^?#\/]*\/)*)([^?#]*))(?:\?([^#]*))?(?:#(.*))?)/.exec(e),b={},c=14;c--;)b[a[c]]=e[c]||"";return b},normalizeParameters:function(d){if(null==d)return"";for(var a,e=t.getParameterList(d),d=[],b=0;b<e.length;++b)a=e[b],"oauth_signature"!=a[0]&&d.push([t.percentEncode(a[0])+" "+t.percentEncode(a[1]),a]);for(d.sort(function(c,a){return c[0]<a[0]?-1:c[0]>a[0]?1:0}),e=[],b=0;b<d.length;++b)e.push(d[b][1]);return t.formEncode(e)}}),t.SignatureMethod.registerMethodClass(["PLAINTEXT","PLAINTEXT-Accessor"],t.SignatureMethod.makeSubclass(function(){return this.key})),t.SignatureMethod.registerMethodClass(["HMAC-SHA1","HMAC-SHA1-Accessor"],t.SignatureMethod.makeSubclass(function(e){s="=";var a=this.key,b=m(a);16<b.length&&(b=l(b,a.length*v));for(var c=Array(16),a=Array(16),d=0;16>d;d++)c[d]=909522486^b[d],a[d]=1549556828^b[d];for(e=l(c.concat(m(e)),512+e.length*v),e=l(a.concat(e),672),b="",a=0;a<4*e.length;a+=3)for(c=(255&e[a>>2]>>8*(3-a%4))<<16|(255&e[a+1>>2]>>8*(3-(a+1)%4))<<8|255&e[a+2>>2]>>8*(3-(a+2)%4),d=0;4>d;d++)b=8*a+6*d>32*e.length?b+s:b+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(63&c>>6*(3-d));return b}));var s="",v=8;o.prototype.sendRequest=function(b,a,d,c){var g=p.js.sdk.utils.getAuthType(this);if(g==p.constants.unknown)c(p.constants.noAppKeyError);else{var f=this.apiBaseURL+"/"+p.sdk.url.version+"/"+b,f=g==p.constants.app_key?f+(p.constants.keyParam+this.appKey):f+(p.constants.oauthKeyParam+this.oauthKey);if(null==d&&(d={}),a=a?a.toUpperCase():p.constants.get_method,d[p.constants.suppressCode]="true",!this.isThreeLegged()){var l=p.js.sdk.utils.getCookie(p.constants.sessionId);l||(l=this.session_id),l&&(f=-1==f.indexOf("?")?f+("?"+p.constants.sessionId+"="+l):f+("&"+p.constants.sessionId+"="+l))}if(this.isThreeLegged()&&(!this.accessToken&&(l=this.getSession())&&(this.accessToken=l.access_token),this.accessToken&&(d[p.constants.accessToken]=this.accessToken)),l=d,Ti.App.analytics){var k=l.analytics||{};k.id=Ti.Platform.createUUID(),Ti.Platform.id&&(k.mid=Ti.Platform.id),k.aguid=Ti.App.guid,k.event="cloud."+b.replace(/\//g,".").replace(/\.json/,""),k.deploytype=Ti.App.deployType||"development",k.sid=Ti.App.sessionId,l.ti_analytics=JSON.stringify(k)}if(d=p.js.sdk.utils.cleanInvalidData(d),b=p.js.sdk.utils.getFileObject(d)){try{var j;if(j=b.toString().match(/TiFilesystemFile/)?b.read():b,!j)return void c(p.constants.fileLoadError);d[p.constants.file]?(delete d[p.constants.file],d[p.constants.file]=j):d[p.constants.photo]&&(delete d[p.constants.photo],d[p.constants.photo]=j)}catch(a){return void c(p.constants.fileLoadError)}j={},(g==p.constants.oauth||g==p.constants.three_legged_oauth)&&(g={method:a,action:f,parameters:[]},p.js.sdk.utils.populateOAuthParameters(g.parameters,this.oauthKey),this.oauthSecret&&t.completeRequest(g,{consumerSecret:this.oauthSecret}),j[p.constants.oauth_header]=t.getAuthorizationHeader("",g.parameters))}else if(j={},g==p.constants.oauth||g==p.constants.three_legged_oauth){var m,g={method:a,action:f,parameters:[]};for(m in d)d.hasOwnProperty(m)&&g.parameters.push([m,d[m]]);p.js.sdk.utils.populateOAuthParameters(g.parameters,this.oauthKey),this.oauthSecret&&t.completeRequest(g,{consumerSecret:this.oauthSecret}),j[p.constants.oauth_header]=t.getAuthorizationHeader("",g.parameters)}p.js.sdk.utils.sendAppceleratorRequest(f,a,d,j,c,this)}},o.prototype.sendAuthRequest=function(b){if(p.js.sdk.utils.getAuthType(this)!==p.constants.three_legged_oauth)alert("wrong authorization type!");else{var b=b||{},a=this.authBaseURL,a=a+"/oauth/authorize"+(p.constants.oauthKeyParam+this.oauthKey),a=a+(p.constants.clientIdParam+this.oauthKey),a=a+(p.constants.responseTypeParam+"token"),b=b.params||{};b.action="login",b.url=a;var e=this,c=b.cb;c&&delete b.cb,p.js.sdk.ui(b,function(b){e.saveSession(b),c&&c(b)})}},o.prototype.signUpRequest=function(b){if(p.js.sdk.utils.getAuthType(this)!==p.constants.three_legged_oauth)alert("wrong authorization type!");else{var b=b||{},a=this.authBaseURL,a=a+"/users/sign_up"+(p.constants.oauthKeyParam+this.oauthKey),a=a+(p.constants.clientIdParam+this.oauthKey),b=b.params||{};b.action="signup",b.url=a;var e=this,c=b.cb;c&&delete b.cb,p.js.sdk.ui(b,function(b){e.saveSession(b),c&&c(b)})}},o.prototype.saveSession=function(b){return b&&b.access_token?(p.js.sdk.utils.setCookie(p.constants.accessToken,b.access_token),p.js.sdk.utils.setCookie(p.constants.expiresIn,b.expires_in),this.accessToken=b.access_token,this.expiresIn=b.expires_in,this.authorized=!0):this.authorized=!1},o.prototype.getSession=function(){var b={access_token:p.js.sdk.utils.getCookie(p.constants.accessToken),expires_in:p.js.sdk.utils.getCookie(p.constants.expiresIn)};return b.access_token?(this.accessToken=b.access_token,this.expiresIn=b.expires_in,this.authorized=!0,b):this.authorized=!1},o.prototype.clearSession=function(){p.js.sdk.utils.setCookie(p.constants.accessToken,""),p.js.sdk.utils.setCookie(p.constants.expiresIn,""),delete this.accessToken,delete this.expiresIn,this.authorized=!1},o.prototype.checkStatus=function(){return!!this.getSession()},p=void 0,p={constants:{},js:{}},p.js.sdk={},p.js.sdk.utils={},p.sdk={},p.sdk.url={},p.sdk.url.baseURL="https://api.cloud.appcelerator.com",p.sdk.url.authBaseURL="https://secure-identity.cloud.appcelerator.com",p.sdk.url.version="v1",p.constants.get_method="GET",p.constants.post_method="POST",p.constants.put_method="PUT",p.constants.delete_method="DELETE",p.constants.app_key=1,p.constants.oauth=2,p.constants.three_legged_oauth=3,p.constants.unknown=-1,p.constants.keyParam="?key=",p.constants.oauthKeyParam="?oauth_consumer_key=",p.constants.clientIdParam="&client_id=",p.constants.redirectUriParam="&redirect_uri=",p.constants.responseTypeParam="&response_type=",p.constants.accessToken="access_token",p.constants.expiresIn="expires_in",p.constants.appKey="app_key",p.constants.json="json",p.constants.sessionId="_session_id",p.constants.sessionCookieName="Cookie",p.constants.responseCookieName="Set-Cookie",p.constants.file="file",p.constants.suppressCode="suppress_response_codes",p.constants.response_wrapper="response_wrapper",p.constants.photo="photo",p.constants.method="_method",p.constants.name="name",p.constants.value="value",p.constants.oauth_header="Authorization",p.constants.noAppKeyError={meta:{status:"fail",code:409,message:"Application key is not provided."}},p.constants.fileLoadError={meta:{status:"fail",code:400,message:"Unable to load file"}},p.js.sdk.utils.getSessionParams=function(){var b=null,a=p.js.sdk.utils.getCookie(p.constants.sessionId);return a&&(b=p.constants.sessionId+"="+a),b},p.js.sdk.utils.cookieMap=[],p.js.sdk.utils.cookieMap[p.constants.sessionId]="sessionId",p.js.sdk.utils.cookieMap[p.constants.accessToken]="accessToken",p.js.sdk.utils.cookieMap[p.constants.expiresIn]="expiresIn",p.js.sdk.utils.securityManager=null,p.js.sdk.utils.getCookie=function(b){return(b=p.js.sdk.utils.cookieMap[b])&&k[b]||null},p.js.sdk.utils.setCookie=function(b,a){var d=p.js.sdk.utils.cookieMap[b];d&&(""===a?delete k[d]:k[d]=a)},p.js.sdk.utils.deleteCookie=function(b){(b=p.js.sdk.utils.cookieMap[b])&&delete k[b]},p.js.sdk.utils.getAuthType=function(b){if(b){if(b.isThreeLegged())return p.constants.three_legged_oauth;if(b.appKey)return p.constants.app_key;if(b.oauthKey&&b.oauthSecret)return p.constants.oauth}return p.constants.unknown},p.js.sdk.utils.getFileObject=function(b){if(b)for(var a in b)if(b.hasOwnProperty(a)&&(a==p.constants.photo||a==p.constants.file))return b[a];return null},p.js.sdk.utils.cleanInvalidData=function(b){if(b){for(var a in b)if(b.hasOwnProperty(a)){if(null==b[a]&&delete b[a],"object"==typeof b[a]){if(a==p.constants.photo||a==p.constants.file)continue;b[a]=JSON.stringify(b[a])}(!0===b[a]||!1===b[a])&&(b[a]=b[a]?1:0)}return b}return{}},p.js.sdk.utils.uploadMessageCallback=function(b){return b&&b.data?JSON.parse(b.data):{}},p.js.sdk.utils.getOAuthParameters=function(d){var a="";if(d)for(var d=t.getParameterList(d),b=0;b<d.length;++b){var c=d[b],e=c[0];0==e.indexOf("oauth_")&&"oauth_token"!=e&&(a+="&"+t.percentEncode(e)+"="+t.percentEncode(c[1]))}return 0<a.length&&(a=a.substring(1)),a},p.js.sdk.utils.populateOAuthParameters=function(c,a){c&&a&&(c.push(["oauth_version","1.0"]),c.push(["oauth_consumer_key",a]),c.push(["oauth_signature_method","HMAC-SHA1"]),c.push(["oauth_nonce",t.nonce(15)]))},p.js.sdk.utils.sendAppceleratorRequest=function(d,b,e,c,g,f){var h=Ti.Network.createHTTPClient({timeout:6E4,onsendstream:function(c){k.onsendstream&&k.onsendstream({url:d,progress:c.progress})},ondatastream:function(c){k.ondatastream&&k.ondatastream({url:d,progress:c.progress})},onerror:function(d){var a={};if(this.responseText){var b=this.responseText;try{(b=b.trim())&&0<b.length&&(a=JSON.parse(b))}catch(b){a=b}}a.message||(a.message=d.error),a.error=!0,a.statusText=this.statusText,a.status=this.status,a.meta&&(a.metaString=JSON.stringify(a.meta)),g(a)},onload:function(){var b=JSON.parse(this.responseText);if(b&&b.meta&&(b.metaString=JSON.stringify(b.meta),b.meta.session_id)){var a=b.meta.session_id;p.js.sdk.utils.setCookie(p.constants.sessionId,a),f.session_id=a}g(b)},securityManager:p.js.sdk.utils.securityManager}),i=d;if(b.toUpperCase()==p.constants.get_method||b.toUpperCase()==p.constants.delete_method){var j,l="";for(j in e)e.hasOwnProperty(j)&&(l+="&"+j+"="+t.percentEncode(e[j]));0<l.length&&(i=0<d.indexOf("?")?i+l:i+("?"+l.substring(1)),e={})}if(k.debug&&(Ti.API.info(b+": "+i),Ti.API.info("header: "+JSON.stringify(c)),Ti.API.info("data: "+JSON.stringify(e))),h.open(b,i),"mobileweb"!=Ti.Platform.osname&&h.setRequestHeader("Accept-Encoding","gzip,deflate"),c)for(j in c)c.hasOwnProperty(j)&&h.setRequestHeader(j,c[j]);h.send(e)},p.js.sdk.utils.decodeQS=function(e){var a,d,f=decodeURIComponent,b={},e=e.split("&");for(a=0;a<e.length;a++)(d=e[a].split("=",2))&&d[0]&&(b[f(d[0])]=f(d[1]));return b},p.js.sdk.utils.guid=function(){return"f"+(1073741824*Math.random()).toString(16).replace(".","")},p.js.sdk.utils.copy=function(e,a,b,c){for(var d in a)(b||"undefined"==typeof e[d])&&(e[d]=c?c(a[d]):a[d]);return e},p.js.sdk.utils.setSecurityManager=function(b){p.js.sdk.utils.securityManager=b};var r={session:null,fetchSetting:function(e,a){var b,c="production"==Ti.App.deployType.toLowerCase()?"production":"development";return(b=Ti.App.Properties.getString(e+"-"+c))&&"undefined"!=b||(b=Ti.App.Properties.getString(e))&&"undefined"!=b?b:a},fetchSession:function(){var b=r.fetchSetting("acs-api-key",null),a=r.fetchSetting("acs-base-url",p.sdk.url.baseURL),e=r.fetchSetting("acs-authbase-url",p.sdk.url.authBaseURL),c=r.fetchSetting("acs-oauth-key",null),d=r.fetchSetting("acs-oauth-secret",null);return new o(b,c,d,a,e)}};return r.getSession=function(){return null==r.session&&(r.session=r.fetchSession()),r.session},r.send=function(e,a,b,c){r.getSession().sendRequest(e,a,b,c)},r.hasStoredSession=function(){return!!p.js.sdk.utils.getCookie(p.constants.sessionId)},r.retrieveStoredSession=function(){return p.js.sdk.utils.getCookie(p.constants.sessionId)},r.reset=function(){p.js.sdk.utils.deleteCookie(p.constants.sessionId),r.session&&(r.session.clearSession(),r.session=null)},r.secureSend=function(d,a){var b=r.getSession();b.useThreeLegged(!0),"secureCreate"===d?b.signUpRequest(a):"secureLogin"==d&&b.sendAuthRequest(a)},r.checkStatus=function(){return r.getSession().checkStatus()},p.js.sdk.UIManager={redirect_uri:"acsconnect://success",displayModal:function(b){function a(b){var d=/^acsconnect:\/\/([^#]*)#(.*)/.exec(decodeURIComponent(b.url));if(d&&3==d.length){var h=null;if("success"==d[1])h=p.js.sdk.utils.decodeQS(d[2]);else if("cancel"!=d[1])return;i.removeEventListener("beforeload",a),i.removeEventListener("load",a),e=h,null==g?c&&c.close():g.close()}f&&"load"==b.type&&(c.remove(f),f=null)}k.debug&&Ti.API.info("ThreeLegged Request url: "+b.url);var e,g=null,c=Ti.UI.createWindow({fullscreen:!1,title:b.params.title||"Appcelerator Cloud Service"}),i=Ti.UI.createWebView({url:b.url,scalesPageToFit:!1,showScrollbars:!0}),f=Ti.UI.createLabel({text:"Loading, please wait...",color:"black",width:Ti.UI.SIZE||"auto",height:Ti.UI.SIZE||"auto",zIndex:100});if(i.addEventListener("beforeload",a),i.addEventListener("load",a),c.addEventListener("close",function(){b&&(b.cb&&b.cb(e),i=c=f=b=e=null)}),"android"!=Ti.Platform.osname){var h=Ti.UI.createButton({title:"close",width:"50%",height:"20%"});h.addEventListener("click",function(){g.close()}),c.rightNavButton=h,("iphone"==Ti.Platform.osname||"ios"==Ti.Platform.osname)&&(g=Ti.UI.iOS.createNavigationWindow({window:c}))}c.add(i),c.add(f),null==g?c.open():g.open({modal:!0})},processParams:function(b,c){return{cb:c,url:b.url+p.constants.redirectUriParam+p.js.sdk.UIManager.redirect_uri,params:b}}},p.js.sdk.ui=function(b,a){if("mobileweb"===Ti.Platform.osname)alert("Three Legged OAuth is not currently supported on MobileWeb");else if(b.action){var d=p.js.sdk.UIManager.processParams(b,a);d&&p.js.sdk.UIManager.displayModal(d)}else alert("\"action\" is a required parameter for com.cocoafish.js.sdk.ui().")},k}